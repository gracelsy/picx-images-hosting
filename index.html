<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>图片列表</title>
<style>
body { font-family: system-ui; padding: 20px; background: #f5f5f5; }
input, select { padding: 8px; margin-right: 8px; }
.grid {
  margin-top: 20px;
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 16px;
}
.card {
  background: #fff;
  border-radius: 10px;
  overflow: hidden;
  box-shadow: 0 2px 6px rgba(0,0,0,.06);
}
.card img {
  width: 100%;
  aspect-ratio: 1/1;
  object-fit: cover;
}
.meta {
  padding: 8px 10px;
}
.filename {
  font-size: 13px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.dir {
  font-size: 11px;
  color: #666;
}
button {
  margin-top: 6px;
  width: 100%;
  font-size: 12px;
}
</style>
</head>

<body>

<h1>图片列表</h1>

<select id="dir"></select>
<input id="search" placeholder="搜索文件名…" />

<div class="grid" id="grid"></div>
<div id="pagination"></div>

<script>
const PAGE_SIZE = 24;
let images = [];
let filtered = [];
let page = 1;

fetch("images.json")
  .then(r => r.json())
  .then(data => {
    images = data;
    initDir();
    apply();
  });

function initDir() {
  const dirs = ["/", ...new Set(images.map(i => i.dir))];
  const sel = document.getElementById("dir");
  sel.innerHTML = dirs.map(d => `<option value="${d}">${d}</option>`).join("");
}

document.getElementById("dir").onchange =
document.getElementById("search").oninput = () => {
  page = 1;
  apply();
};

function apply() {
  const d = document.getElementById("dir").value;
  const q = document.getElementById("search").value.toLowerCase();

  filtered = images.filter(i =>
    (d === "/" || i.dir === d) &&
    i.path.toLowerCase().includes(q)
  );

  render();
}

function render() {
  const grid = document.getElementById("grid");
  grid.innerHTML = "";

  const start = (page - 1) * PAGE_SIZE;
  const items = filtered.slice(start, start + PAGE_SIZE);

  for (const i of items) {
    grid.innerHTML += `
      <div class="card">
        <img src="${i.path}">
        <div class="meta">
          <div class="filename" title="${i.path}">${i.path}</div>
          <div class="dir">${i.dir}</div>
          <button onclick="navigator.clipboard.writeText(location.origin + '/${i.path}')">
            复制链接
          </button>
        </div>
      </div>`;
  }

  renderPage();
}

function renderPage() {
  const total = Math.ceil(filtered.length / PAGE_SIZE);
  const p = document.getElementById("pagination");
  p.innerHTML = "";
  for (let i = 1; i <= total; i++) {
    const b = document.createElement("button");
    b.textContent = i;
    if (i === page) b.disabled = true;
    b.onclick = () => { page = i; render(); };
    p.appendChild(b);
  }
}
</script>

</body>
</html>